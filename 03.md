## Exercise 3: Use Azure Blueprints to govern your Azure environment

Duration: 75 minutes

In this exercise you will create an Azure Blueprint at the Management Group scope to model your Azure environment using Azure Blueprint artifacts such as resource groups, Azure Resource Manager templates, resource locks, Azure Policy, and Azure RBAC.

### Help references

|                                                                         |                                                                                              |
|-------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------|
| Overview of the Azure Blueprints service                                | <https://docs.microsoft.com/azure/governance/blueprints/overview>                            |
| Understand resource locking in Azure Blueprints                         | <https://docs.microsoft.com/azure/governance/blueprints/concepts/resource-locking>           |
| Azure Resource Manager overview                                         | <https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview>            |
| Understand the structure and syntax of Azure Resource Manager templates | <https://docs.microsoft.com/azure/azure-resource-manager/resource-group-authoring-templates> |
| Get compliance data of Azure resources                                  | <https://docs.microsoft.com/azure/governance/policy/how-to/get-compliance-data>              |

### Task 1: Create a new Azure Blueprint

In this task, you will create a new Azure Blueprint and add several artifacts to the blueprint. You will then save a draft of the blueprint.

1. Sign out and sign back into the portal with your regular global admin credentials. 

2. In the Azure portal at <https://portal.azure.com> navigate to the Azure Blueprints service by selecting **All services**, searching for **Blueprints**, and then selecting **Blueprints**.

    ![Blueprints service under the All services menu.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image117.png "Azure Blueprints under All services in the Azure portal")

    > **Tip**: You can pin the Blueprints service to the portal navigation by selecting the star next to **Blueprints**.

3. In the **Getting started** blade, select **Create** under **Create a blueprint**. 

    ![Getting started blade with the Create button under Create a blueprint highlighted.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image118.png "Create a blueprint")

4. Select **Start with a blank blueprint**.

    ![Choose a blueprint sample blade with the Blank Blueprint tile highlighted.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image119.png "Create a blank blueprint")

5. In the **Create blueprint** blade, enter the following to complete the form:

    - Blueprint name: **governance-baseline**

    - Blueprint description: **The governance-baseline blueprint will be applied to all subscriptions within the ERC management group.**
  
    - Definition location: **Enterprise Ready Cloud** management group

    ![Create blueprint blade with the form completed.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image120.png "Create blueprint")

6. Select **Next : Artifacts >>**.

7. Select **+ Add artifact...** and then select **Policy assignment** for the **Artifact type** in the **Add artifact** blade.

    ![Add artifact blade in the Azure portal with the Policy assignment artifact type selected.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image121.png "Add artifact")

8. Select the **Require a tag on resource groups** policy and select **Add**.

    ![Add artifact blade in the Azure portal with the Policy assignment artifact type selected and the Require a tag on resource groups policy definition highlighted.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image132.png "Add artifact policy definition selection")

    > **Note**: In Exercise 2, Azure Policy was used to automatically tag resources as they were created in a resource group but recall that any tags on the resource group itself were not inherited. Through this blueprint, we will ensure that the *IOCode* and *CostCenter* tags are enforced on each resource group that is created *and* that the tags that are set on the resource group are automatically inherited by any child resources.

9.  Select **+ Add artifact...** and then select **Policy assignment** for the **Artifact type** in the **Add artifact** blade.

    ![Add artifact blade in the Azure portal with the Policy assignment artifact type selected.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image121.png "Add artifact")

10. Select the **Require a tag on resource groups** policy and select **Add**.

    ![Add artifact blade in the Azure portal with the Policy assignment artifact type selected and the Require a tag on resource groups policy definition highlighted.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image132.png "Add artifact policy definition selection")

    > **Note**: We need to add two of the same policy definition so we can enforce each tag for *IOCode* and *CostCenter*.

11. Select **+ Add artifact...** and then select **Policy assignment** for the **Artifact type** in the **Add artifact** blade.

    ![Add artifact blade in the Azure portal with the Policy assignment artifact type selected.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image121.png "Add artifact")

12. Select the **Append a tag and its value from the resource group** policy and select **Add**.

    ![Add artifact blade in the Azure portal with the Policy assignment artifact type selected and the Append a tag and its value from the resource group policy definition highlighted.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image123.png "Add artifact policy definition selection")

13. Select **+ Add artifact...** and then select **Policy assignment** for the **Artifact type** in the **Add artifact** blade.

    ![Add artifact blade in the Azure portal with the Policy assignment artifact type selected.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image121.png "Add artifact")

14. Select the **Append a tag and its value from the resource group** policy and select **Add**.

    ![Add artifact blade in the Azure portal with the Policy assignment artifact type selected and the Append a tag and its value from the resource group policy definition highlighted.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image123.png "Add artifact policy definition selection")

    > **Note**: We need to add two of the same policy definition so we can ensure each tag for *IOCode* and *CostCenter* is replicated from the resource group to any child resources.

15. Select **+ Add artifact...** and then select **Azure Resource Manager template (Subscription)** for the **Artifact type** in the **Add artifact** blade.

    ![Add artifact blade in the Azure portal with the Azure Resource Manager template (Subscription) artifact type selected.](images/Hands-onlabstep-by-step-Enterprise-readycloudimages/media/image125.png "Add artifact")

16. Complete the form with the following information. This resource group will be used to demonstrate that the policy enacted in our blueprint is working by creating a resource group and then creating a storage account within that resource group.

    - Artifact display name: **BU-RG**
